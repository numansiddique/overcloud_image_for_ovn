From d5c5ab7d487be24a57739c02d61c74f1152d3099 Mon Sep 17 00:00:00 2001
From: Babu Shanmugam <bschanmu@redhat.com>
Date: Fri, 25 Nov 2016 04:52:35 +0000
Subject: [PATCH 2/3] OVN bridge mappings for tripleo

This patch adds an additional configuration setting for OVN bridge mappings

Change-Id: I99f2c0c8e633e63273e2469d95fbabbbc665c87c
Depends-On: Ia6d66fa954571328c0ac3542af17303def382c1a
---
 environments/neutron-ml2-ovn.yaml               | 1 +
 puppet/services/neutron-compute-plugin-ovn.yaml | 9 +++++++++
 2 files changed, 10 insertions(+)

diff --git a/environments/neutron-ml2-ovn.yaml b/environments/neutron-ml2-ovn.yaml
index 7b6baec..fac8da1 100644
--- a/environments/neutron-ml2-ovn.yaml
+++ b/environments/neutron-ml2-ovn.yaml
@@ -22,3 +22,4 @@ parameter_defaults:
   NeutronNetworkType: 'geneve'
   NeutronServicePlugins: 'qos,networking_ovn.l3.l3_ovn.OVNL3RouterPlugin'
   NeutronVniRanges: ['1:65536', ]
+  OVNBridgeMappings: 'datacentre:br-ex'
diff --git a/puppet/services/neutron-compute-plugin-ovn.yaml b/puppet/services/neutron-compute-plugin-ovn.yaml
index 1e335f5..203d617 100644
--- a/puppet/services/neutron-compute-plugin-ovn.yaml
+++ b/puppet/services/neutron-compute-plugin-ovn.yaml
@@ -26,6 +26,10 @@ parameters:
     description: Tunnel encapsulation type
     type: string
     default: geneve
+  OVNBridgeMappings:
+    description: Bridge mappings for the localnet configuration
+    type: comma_delimited_list
+    default: ''
 
 
 outputs:
@@ -37,6 +41,11 @@ outputs:
         ovn::southbound::port: {get_param: OVNSouthboundServerPort}
         ovn::controller::ovn_encap_type: {get_param: OVNTunnelEncapType}
         ovn::controller::ovn_encap_ip: {get_param: [ServiceNetMap, NeutronApiNetwork]}
+        ovn::controller::ovn_bridge_mappings:
+          str_replace:
+            template: MAPPINGS
+            params:
+              MAPPINGS: {get_param: OVNBridgeMappings}
         tripleo.neutron_compute_plugin_ovn.firewall_rules:
           '118 neutron geneve networks':
             proto: 'udp'
-- 
2.9.3

